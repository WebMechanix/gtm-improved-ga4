___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "WebMechanix - Improved GA4",
  "categories": ["ANALYTICS", "ADVERTISING", "MARKETING"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "WebMechanix",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDcuMC1jMDAwIDc5LmRhYmFjYmIsIDIwMjEvMDQvMTQtMDA6Mzk6NDQgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ODlkMDQ0YTctMDVlYS00MDZkLWE1MTAtYmU2YjQ1N2I5MjYzIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjkwMTVDQUZBRTYzMzExRUJBNUQ4RUQ0NTZFNzE0NzREIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjkwMTVDQUY5RTYzMzExRUJBNUQ4RUQ0NTZFNzE0NzREIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMS4wIChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ZGYzYjhmMDUtMzg4Mi00YWMxLWIyY2MtMTc1ODBkMjg3ODg5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjg5ZDA0NGE3LTA1ZWEtNDA2ZC1hNTEwLWJlNmI0NTdiOTI2MyIv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\u003d"
  },
  "description": "A GA4 tag template with an improved UI which allows for greater flexibility than the provided GA4 tag templates from Google. Load event parameters, and user properties from a variable containing an object in addition to setting them as key:values explicitly.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "type",
    "displayName": "Tag Type",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "config",
        "displayValue": "Config"
      },
      {
        "value": "event",
        "displayValue": "Event"
      }
    ],
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "measurementId",
    "displayName": "Measurement ID",
    "simpleValueType": true,
    "help": "Enter the Measurement ID (e.g, G-A2ABC2ABCD) for your GA4 property. \u003ca href\u003d\"https://support.google.com/analytics/answer/9310895\" target\u003d\"_blank\"\u003eLearn more\u003c/a\u003e",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "config",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "eventName",
    "displayName": "Event Name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "event",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "sendPageView",
    "checkboxText": "Send a page_view event when this configuration loads",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "config",
        "type": "EQUALS"
      }
    ],
    "defaultValue": true
  },
  {
    "type": "CHECKBOX",
    "name": "enableConstants",
    "checkboxText": "Automatically add helpful globals to all events?",
    "simpleValueType": true,
    "defaultValue": false
  },
  {
    "type": "GROUP",
    "name": "constants",
    "displayName": "Constants",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "containerId",
        "checkboxText": "GTM Container ID",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "type",
            "paramValue": "config",
            "type": "EQUALS"
          }
        ],
        "help": "Attached as an \u003cstrong\u003econtainer_id\u003c/strong\u003e parameter."
      },
      {
        "type": "CHECKBOX",
        "name": "containerVersion",
        "checkboxText": "GTM Container Version",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "type",
            "paramValue": "config",
            "type": "EQUALS"
          }
        ],
        "help": "Attached as an \u003cstrong\u003econtainer_version\u003c/strong\u003e parameter."
      },
      {
        "type": "CHECKBOX",
        "name": "timestamp",
        "checkboxText": "Timestamp",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "type",
            "paramValue": "event",
            "type": "EQUALS"
          }
        ],
        "help": "Attached as an \u003cstrong\u003eevent_timestamp\u003c/strong\u003e parameter."
      }
    ],
    "enablingConditions": [
      {
        "paramName": "enableConstants",
        "paramValue": false,
        "type": "NOT_EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "fieldsGroup",
    "displayName": "Fields to Set",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SELECT",
        "name": "fieldsFromVariable",
        "displayName": "Load Fields From Variable",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": false,
            "displayValue": "False"
          }
        ],
        "simpleValueType": true,
        "help": "You can use a variable that returns a JavaScript object with the fields you want to set. This object will be merged with any additional fields you set via the table below. Any conflicts will be resolved in favor of the fields you add to the table."
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "fieldsList",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Field Name",
            "name": "name",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "config",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "parametersGroup",
    "displayName": "Event Parameters",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SELECT",
        "name": "parametersFromVariable",
        "displayName": "Load Parameters From Variable",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": false,
            "displayValue": "False"
          }
        ],
        "simpleValueType": true,
        "help": "You can use a variable that returns a JavaScript object with the parameters you want to set. This object will be merged with any additional parameters you set via the table below. Any conflicts will be resolved in favor of the parameters you add to the table."
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "parametersList",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Field Name",
            "name": "name",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "type": "REGEX",
                "args": [
                  "[a-z_\\.\\-]{1,40}"
                ]
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "event",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "userPropertiesGroup",
    "displayName": "User Properties",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SELECT",
        "name": "userPropertiesFromVariable",
        "displayName": "Load Properties From Variable",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": false,
            "displayValue": "False"
          }
        ],
        "simpleValueType": true,
        "help": "You can use a variable that returns a JavaScript object with the properties you want to use. This object will be merged with any additional properties you add via the table below. Any conflicts will be resolved in favor of the properties you add to the table."
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "userPropertiesList",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Property Name",
            "name": "name",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "type": "REGEX",
                "args": [
                  "[a-z_]{1,40}"
                ]
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "groupAssignment",
    "displayName": "Assign to Google Tag Groups",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "LABEL",
        "name": "gtagGroupText",
        "displayName": "If you are running multiple Improved GA4 config tags on a page, you can assign them to specific groups to have better control over where data is sent with other Improved GA4 event tags. See: \u003ca href\u003d\"https://developers.google.com/tag-platform/gtagjs/routing\"\u003ehttps://developers.google.com/tag-platform/gtagjs/routing\u003c/a\u003e. \u003cstrong\u003eTags are automatically added to the \"default\" group.\u003c/strong\u003e"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "gtagGroups",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "",
            "name": "name",
            "type": "TEXT",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "type": "REGEX",
                "args": [
                  "[a-zA-Z_\\-0-9]+"
                ]
              }
            ]
          }
        ],
        "newRowButtonText": "Add group",
        "help": ""
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "config",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "destinations",
    "displayName": "Send to Specific Tags or Groups",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "LABEL",
        "name": "destinationsGroupText",
        "displayName": "You may specify one or more destinations for this event data to be sent. These can be tag IDs or groups as defined inside your Improved GA4 config tag types. By default events will be sent to all tags configured on the page."
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "sendTo",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "",
            "name": "name",
            "type": "TEXT",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "type": "REGEX",
                "args": [
                  "[a-zA-Z_\\-0-9]+"
                ]
              }
            ]
          }
        ],
        "newRowButtonText": "Add destination",
        "help": ""
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "event",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const copyFromWindow = require('copyFromWindow');
const createArgumentsQueue = require('createArgumentsQueue');
const getContainerVersion = require('getContainerVersion');
const getTimestampMillis = require('getTimestampMillis');
const getType = require('getType');
const injectScript = require('injectScript');
const JSON = require('JSON');
const log = require('logToConsole');
const makeTableMap = require('makeTableMap');
const createQueue = require('createQueue');

/* START CODE */

log('Improved GA4 - data: ', data);

const namespace = 'gtag';
const dataLayerName = 'dataLayer';
const GTM = getContainerVersion();

const dataLayerPush = createQueue(dataLayerName);

const mergeObj = (obj, obj2) => {
  for (let key in obj2) {
    if (obj2.hasOwnProperty(key)) {
      obj[key] = obj2[key];
    }
  }
  return obj;
};

const mergeSettings = (fromVar, tableKey) => {
  const defaults = getType(data[fromVar]) === 'object' ? data[fromVar] : {};
  const overrides = data[tableKey] && data[tableKey].length ? makeTableMap(data[tableKey], 'name', 'value') : {};
  return mergeObj(defaults, overrides);
};

const getGlobal = () => {
  
  let gtag = copyFromWindow(namespace);
  
  if (gtag) 
    return gtag;
  
  gtag = createArgumentsQueue(namespace, dataLayerName);
  gtag('js', getTimestampMillis()/1000);
  
  return gtag;
  
};

const gtag = getGlobal();

const userProperties = mergeSettings('userPropertiesFromVariable', 'userPropertiesList');
log('Improved GA4 - userProperties: ', userProperties);


if (data.type == 'config') {
  
  const fields = mergeSettings('fieldsFromVariable', 'fieldsList');
  
  fields.send_page_view = data.sendPageView;
  
  if (data.gtagGroups) {
    
    fields.groups = ['default'];
    
    data.gtagGroups.forEach((group) => {
      fields.groups.push(group.name);
    });
    
  }
  
  if (data.enableConstants) {
    
    if (data.containerId)
      fields.container_id = GTM.containerId;
      
    if (data.containerVersion)
      fields.container_version = GTM.version;
    
  }
  
  fields.user_properties = userProperties;
  
  gtag('config', data.measurementId, fields);
  
  log(fields);
  
  /*gtag('get', data.measurementId, 'session_id', function(field) {
    dataLayerPush({
      session_id: field
    });
  });*/
  
}

if (data.type == 'event') {
  
  const parameters = mergeSettings('parametersFromVariable', 'parametersList');
  
  if (data.sendTo) {
    
    parameters.send_to = [];
    
    data.sendTo.forEach((item) => {
      parameters.send_to.push(item.name);
    });
    
  }
  
  if (data.enableConstants) {
      
    if (data.timestamp)
      parameters.event_timestamp = getTimestampMillis();
    
  }
  
  parameters.user_properties = userProperties;
  
  log('Improved GA4 - event_parameters: ', parameters);
  
  gtag('event', data.eventName, parameters);
  
}

const scriptUrl = 'https://www.googletagmanager.com/gtag/js?id=' + data.measurementId + '&l=' + dataLayerName + '&cx=c';

injectScript(scriptUrl, data.gtmOnSuccess, data.gtmOnFailure, namespace);

data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "gtag"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://www.googletagmanager.com/gtag/js/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 9/23/2022, 6:50:37 PM